<style>
    .swal-text {
        text-align: center!important;
    }
</style>
<div class="m-subheader ">
    <div class="d-flex align-items-center">
        <div class="mr-auto">
            <h3 class="m-subheader__title m-subheader__title--separator">
                Booking Unit
            </h3>
            <ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
                <li class="m-nav__item m-nav__item--home">
                    <a href="" class="m-nav__link m-nav__link--icon">
                        <i class="m-nav__link-icon la la-home"></i>
                    </a>
                </li>
                <li class="m-nav__separator">
                    -
                </li>
                <li class="m-nav__item">
                    <a href="app/main/dashboard" class="m-nav__link">
                        <span class="m-nav__link-text">
                                Online Booking
                            </span>
                    </a>
                </li>
                <li class="m-nav__separator">
                    -
                </li>
                <li class="m-nav__item">
                    <a href="app/main/cart" class="m-nav__link">
                        <span class="m-nav__link-text">
                                Cart
                            </span>
                    </a>
                </li>
                <li class="m-nav__separator">
                    -
                </li>
                <li class="m-nav__item">
                    <a class="m-nav__link">
                        <span class="m-nav__link-text">
                                Confirm Order
                            </span>
                    </a>
                </li>
            </ul>
        </div>

        <span class="m-subheader__daterange" id="m_dashboard_daterangepicker">
            <myduration></myduration>
        </span>
        <div></div>
    </div>
</div>
<div class="m-content">
    <ol class="progress-track">
        <li class="progress-done">
            <div class="icon-wrap">
                <svg class="icon-state icon-check-mark">
                    <use xlink:href="#icon-check-mark"></use>
                </svg>
                <svg class="icon-state icon-down-arrow">
                    <use xlink:href="#icon-down-arrow"></use>
                </svg>
            </div>
            <span class="progress-text">Unit Selection</span>
        </li>
        <li class="progress-done">
            <div class="icon-wrap">
                <svg class="icon-state icon-check-mark">
                    <use xlink:href="#icon-check-mark"></use>
                </svg>
                <svg class="icon-state icon-down-arrow">
                    <use xlink:href="#icon-down-arrow"></use>
                </svg>
            </div>
            <span class="progress-text">Verify Customer</span>
        </li>
        <li class="progress-done">
            <div class="icon-wrap">
                <svg class="icon-state icon-check-mark">
                    <use xlink:href="#icon-check-mark"></use>
                </svg>
                <svg class="icon-state icon-down-arrow">
                    <use xlink:href="#icon-down-arrow"></use>
                </svg>
            </div>
            <span class="progress-text">Confirm Order</span>
        </li>
    </ol>
    <div class="m-portlet m-portlet--mobile">
        <div class="m-portlet__body">
            <form id="confirm-order-wrapper" [formGroup]="payForm" (ngSubmit)="bookPay()">
                <div class="m-form m-form--label-align-right m--margin-bottom-20">
                    <div class="row align-items-center">
                        <div class="col-xl-8 order-2 order-xl-1">
                            <div class="form-group m-form__group row align-items-center">
                                <div class="col-md-12">
                                    <div class="form-group m-form__group">
                                        <span class="m-form__help" style="margin-bottom:10px">
											<i class="flaticon-exclamation"></i> You should complete booking data through several steps

										</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="m-portlet__head-caption">
                    <div class="m-portlet__head-title" style="margin-bottom:10px">
                        <h3 class="m-portlet__head-text method-type" style="margin-bottom:0">
                            Confirm Order
                        </h3>
                        <small style="color:#95a5a6;font-size:14px">
                            Last step to complete booking is to finish the payment process
                        </small>
                    </div>
                </div>
                <br>
                <p-accordion [multiple]="true">
                    <p-accordionTab header="Customer Data" [selected]="true">
                        <div class="col-sm-12">
                            <table class="table table-striped m-table">
                                <tbody>
                                    <tr>
                                        <th scope="row"> Name</th>
                                        <td> {{detailCustomer.customerName}}</td>
                                        <th scope="row"> ID No</th>
                                        <td> {{detailCustomer.idNo}}</td>
                                    </tr>
                                    <tr>
                                        <th scope="row"> Birth Date</th>
                                        <td> {{dateInput}}</td>
                                        <th scope="row"> Email</th>
                                        <td> {{detailCustomer.email}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </p-accordionTab>
                    <p-accordionTab header="Supporting Data" [selected]="true">
                        <div class="col-sm-12">
                            <div class="form-group m-form__group row">
                                <div class="col-sm-6">
                                    <label class="col-form-label">
                                        Fund Source
                                    </label>
                                    <select [formControl]="model_ctrl.fund" class="form-control foundSource" jq-plugin="selectpicker" title="Choose your fund source" data-live-search="true">
                                        <option value="">Nothing Selected</option>
                                        <option *ngFor="let c of foundSource" [ngValue]="c.sumberDanaId">
                                            {{c.sumberDanaName}}
                                        </option>
                                    </select>
                                    <!-- <span class="text-danger" *ngIf="model_ctrl.fund.hasError('required')  && model_ctrl.fund.touched">Fund Source cannot be empty</span> -->
                                </div>
                                <div class="col-sm-6">
                                    <label class="col-form-label">
                                        Bank Name
                                    </label>
                                    <select [formControl]="model_ctrl.bank" class="form-control bank" jq-plugin="selectpicker" title="Choose your bank" data-live-search="true">
                                        <option value="">Nothing Selected</option>
                                        <option *ngFor="let b of bank" [ngValue]="b.bankID">{{b.bankName}}</option>
                                    </select>
                                    <!-- <input [formControl]="model_ctrl.bank" type="text" class="form-control m-input" name="bankname"
                                           placeholder="Enter bank name" required>                 -->
                                    <!-- <span class="text-danger" *ngIf="model_ctrl.bank.hasError('required')  && model_ctrl.bank.touched"> Bank Name cannot be empty</span>    -->
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <div class="col-sm-6">
                                    <label class="col-form-label">
                                        Transaction Destination
                                    </label>
                                    <select [formControl]="model_ctrl.dest" class="form-control dest" jq-plugin="selectpicker" title="Choose your transaction destination">
                                        <option value="">Nothing Selected</option>
                                        <option *ngFor="let c of transSource" [ngValue]="c.tujuanTransaksiId">
                                            {{c.tujuanTransaksiName}}
                                        </option>
                                    </select>
                                    <!-- <span class="text-danger" *ngIf="model_ctrl.dest.hasError('required')  && model_ctrl.dest.touched">Destination cannot be empty</span> -->
                                </div>
                                <div class="col-sm-6">
                                    <label class="col-form-label">
                                        No. Rekening
                                    </label>
                                    <input [formControl]="model_ctrl.no_rek" type="text" class="form-control m-input" name="cardnumber" placeholder="Enter your card number" required>
                                    <!-- <span class="text-danger" *ngIf="model_ctrl.no_rek.hasError('required')  && model_ctrl.no_rek.touched">No.Rekening cannot be empty</span> -->
                                </div>
                            </div>
                        </div>
                    </p-accordionTab>
                    <p-accordionTab header="Order Detail" [selected]="true">
                        <div class="col-sm-12">
                            <div id="dtable" class="primeng-datatable-container" [busyIf]="primengDatatableHelper.isLoading">
                                <p-dataTable #dataTable [value]="primengDatatableHelper.records" rows="{{primengDatatableHelper.defaultRecordsCountPerPage}}" [lazy]="false" [responsive]="primengDatatableHelper.isResponsive">
                                    <p-column header="No." [sortable]="false" [style]="{'width':'80px', 'text-align':'center'}">
                                        <ng-template let-rowIndex="rowIndex" pTemplate="body">
                                            {{ rowIndex+1 }}
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Project">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <span class="rowData">
                                            {{record.projectName}}
                                            </span>
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Tower / Cluster">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <span class="rowData">
                                            {{record.clusterName}}
                                            </span>
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Unit Code">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <span class="rowData">
                                            {{record.unitCode}}
                                            </span>
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Unit No">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <span class="rowData">
                                            {{record.unitNo}}
                                            </span>
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Term of Payment">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <span class="rowData">
                                            {{record.termName}}
                                            </span>
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Renovation">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <span class="rowData">
                                            {{record.renovName}}
                                            </span>
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Booking Fee">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <div class="rowData" style="text-align: right;">
                                                {{record.bookingFee | currency:'Rp. '}}
                                                <!-- {{record.bookingFee | round | currency:'Rp. '}} -->
                                            </div>
                                        </ng-template>
                                    </p-column>
                                    <p-column header="Selling Price">
                                        <ng-template let-record="rowData" pTemplate="body">
                                            <div class="rowData" style="text-align: right;">
                                                {{record.sellingPrice | currency:'Rp. '}}
                                                <!-- {{record.sellingPrice | round | currency:'Rp. '}} -->
                                            </div>
                                        </ng-template>
                                    </p-column>
                                </p-dataTable>
                            </div>
                        </div>
                        <div class="col-sm-12" style="text-align:right">
                            <span *ngIf="PpnPreview == false" class="text-danger" style="font-weight:500!important; font-style: italic">*Price Exclude VAT (PPN)</span>
                            <span *ngIf="PpnPreview == true" class="text-danger" style="font-weight:500!important; font-style: italic">*Price Include VAT (PPN)</span>
                        </div>
                    </p-accordionTab>
                </p-accordion>

                <div class="col-sm-12">
                    <br>
                    <div class="m-portlet__head-caption">
                        <div class="m-portlet__head-title" style="margin-bottom:10px">
                            <h3 class="m-portlet__head-text method-type" style="margin-bottom:0;font-size:14px">
                                Amount to be Paid
                            </h3>
                            <small style="color:#95a5a6;font-size:12px">
                                Total Booking Fee
                            </small>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="alert m-alert--default" role="alert">
                            <strong>
                                {{rpInput}}
                            </strong>
                            <!-- ( Dua Puluh Lima Juta Rupiah ) -->
                        </div>
                    </div>
                    <br>
                    <div *ngIf="ppnumber!=null" class="m-portlet__head-caption">
                        <div class="m-portlet__head-title" style="margin-bottom:10px">
                            <h3 class="m-portlet__head-text method-type" style="margin-bottom:0;font-size:14px;">
                                Priority Pass Number : {{ppnumber}}
                            </h3>
                        </div>
                    </div>
                    <br>
                    <div class="col-sm-12" *ngIf="otherPaymentStatus !== true" [busyIf]="voucherByUnitCheckLoading">
                        <div class="col-sm-8">
                            <div class="form-group m-form__group row">
                                <div class="col-sm-3" style="margin-top: 10px;">
                                    <input type="radio" name="voucherType" [(ngModel)]="VoucherPp" [ngModelOptions]="{standalone: true}" (change)="onChangeVoucherByUnitCheck(VoucherPp)" value="1">
                                    <b style="font-size: 14px;">Voucher No</b>
                                </div>
                                <div class="col-sm-3" style="margin-top: 10px;">
                                    <input type="radio" name="voucherType" [(ngModel)]="VoucherPp" [ngModelOptions]="{standalone: true}" (change)="onChangeVoucherByUnitCheck(VoucherPp)" value="2">
                                    <b style="font-size: 14px;">
                                        PP No
                                    </b>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6" *ngIf="VoucherPp !== undefined" [busyIf]="onChangeVoucherByUnitCheckLoading" style="background-color: #f4f5f8;padding-top: 10px; padding-bottom: 1px;">
                            <div class="form-group m-form__group row">
                                <div class="col-sm-6">
                                    <b style="font-size: 14px;">Amount To Be Paid</b>
                                </div>
                                <div class="col-sm-5">
                                    <b style="font-size: 14px;">{{rpInput}}</b>
                                </div>
                            </div>
                            <div class="form-group m-form__group row" *ngIf="VoucherPp !== '1'">
                                <div class="col-sm-6" [busyIf]="getPPNoLoading">
                                    <select class="form-control ppno" [formControl]="model_ctrl.ppNo" (change)="onChangePPno(model_ctrl.ppNo)" jq-plugin="selectpicker" title="Choose your ppno" data-live-search="true" multiple>
                                        <option value="">Nothing Selected</option>
                                        <option *ngFor="let _listPPNo of listPPNo" [ngValue]="_listPPNo.message">
                                            {{_listPPNo.message}}
                                        </option>
                                    </select>
                                </div>
                                <div class="col-sm-5" style="padding-top: 8px;" [busyIf]="onChangePPnoLoading">
                                    <b style="font-size: 14px;">{{ppPrice}}</b>
                                </div>
                            </div>
                            <div class="form-group m-form__group row" *ngIf="isSelectedPPLimit">
                                <div class="col-sm-12">
                                    <div class="alert alert-warning">
                                        <em>The amount of Priority Pass Number you choose <strong>does not match or exceed</strong> the number of units ordered.</em>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-form__group row" *ngIf="VoucherPp !== '2'">
                                <div class="col-sm-6">
                                    <input [formControl]="model_ctrl.voucher" [(ngModel)]="voucherValue" (ngModelChange)="onChangeVoucher($event)" type="text" class="form-control m-input" placeholder="Voucher No">
                                </div>
                                <div class="col-sm-5" style="padding-top: 8px;" [busyIf]="onChangeVoucherLoading">
                                    <b style="font-size: 14px;">{{voucherPrice}}</b>
                                </div>
                            </div>
                            <div class="form-group m-form__group row">
                                <div class="col-sm-6">
                                    <b style="font-size: 14px;">Total To Be Paid</b>
                                </div>
                                <div class="col-sm-5">
                                    <b style="font-size: 14px;">{{voucherTotalToBePaid}}</b>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="col-sm-12" *ngIf="hiddenPayment == false">
                        <div *ngIf="totalToBePaid != 0" class="m-portlet__head-caption">
                            <div class="m-portlet__head-title" style="margin-bottom:10px">
                                <h3 class="m-portlet__head-text method-type" style="margin-bottom:0;font-size:14px">
                                    Payment Method
                                </h3>
                                <small style="color:#95a5a6;font-size:12px">
                                    Please choose one for your Booking Fee Payment
                                </small>
                            </div>
                        </div>
                        <div *ngIf="totalToBePaid != 0" class="form-group m-form__group row" style="margin-left:0px!important">
                            <div class="m-radio-inline col-sm-12">
                                <label *ngFor="let item of paySource; let i = index" class="m-radio m-radio--solid">
                                    <input id="pay_{{item.paymentTypeId}}" [(ngModel)]="payType"
                                           [value]="item.paymentTypeId+'|'+item.paymentType"
                                           [ngModelOptions]="{standalone: true}" type="radio" name="paymentMethod" (click)="imgClick()">
                                    
                                    <img 
                                        style="height:30px" 
                                        width="100" 
                                        title="{{item.paymentTypeName}}"
                                        src="data:image/png;base64,{{item.image}}" 
                                        (click)="imgClick()">

                                    <img *ngIf="item.paymentType=='3'" style="height:30px" width="100"
                                         src="../../../assets/app/media/img/bank-logo/visamastercard.png" (click)="imgClick()">
                                    <img *ngIf="item.paymentType=='10'" style="height:30px" width="100"
                                         src="../../../assets/app/media/img/bank-logo/bcaklikpay.png" (click)="imgClick()">
                                    <img *ngIf="item.paymentType=='11'" style="height:30px" width="100"
                                         src="../../../assets/app/media/img/bank-logo/cimbclicls.png" (click)="imgClick()">
                                    <img *ngIf="item.paymentType=='4'" style="height:30px" width="100"
                                         src="../../../assets/app/media/img/bank-logo/banktransfer.png" (click)="imgClick()">
                                    
                                         <span></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="m-portlet__foot m-portlet__foot--fit text-right pad">
                    <div class="m-form__actions">
                        <!-- {{isSelectedPPLimit}} -->
                        <!-- [disabled]="!payForm.valid" -->
                        <button [disabled]="((payType == undefined && payTypee == false) || (payType == undefined && totallastbepaid != 0 && payTypee == true)) || paydisable || isSelectedPPLimit" [ngClass]="payLoading ? 'm-loader m-loader--light m-loader--right' : ''" type="submit" class="btn btn-danger m-btn m-btn--air m-btn--uppercase">
                            Book & Pay 
                            <!-- ( {{payType == undefined && payTypee == false}} || {{payType == undefined && totallastbepaid != 0 && payTypee == true}} ) || {{paydisable}} -->
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="modal_bookingexpired" class="modal modal-menu fade in" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body m--align-center">
                Your
                <code>booking time</code> is expired.
                <br> Booking Again ?

            </div>
            <div class="modal-footer">
                <a id="booking-cancel" class="btn" style="font-weight: 500;font-size: 12px;background-color: #ebedf2">No</a>
                <a id="booking-again" class="btn btn-metal">Yes, booking again</a>
            </div>
        </div>
    </div>
</div>

<div id="popup-banktransfer" class="swal-overlay swal-overlay--hide-modal" tabindex="-1">
    <div class="swal-modal modal-lg" role="dialog" aria-modal="true">
        <div class="swal-icon swal-icon--info"></div>
        <div class="swal-title">Please make a payment for each item to BNI (Bank Negara Indonesia) virtual account number below:</div>
        <div class="swal-text">
            <table>
                <tr *ngFor="let item of listOfBookedUnit">
                    <td style="text-align: left !important">
                        <span class="label m-badge m-badge--primary m-badge--wide" style="width:100% !important">
                           {{item.unit.clusterName}} {{item.unit.unitCode}}-{{item.unit.unitNo}}
                        </span>
                    </td>
                    <td style="text-align: right !important;padding-left: 15px;">{{item.va_number}}</td>
                </tr>
            </table>
        </div>
        <div class="swal-footer" style="padding-top: 20px;">
            <div class="swal-button-container">

                <button class="swal-button swal-button--confirm" routerLink="/app/sales-portal/dashboard">OK</button>

                <div class="swal-button__loader">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>

            </div>
        </div>
    </div>
</div>